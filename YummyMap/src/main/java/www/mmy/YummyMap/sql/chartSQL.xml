<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
			PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
					"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
					
<mapper namespace="chartSQL">

		 <!-- 음식점 카테고리 차트 쿼리 -->
	 	<select id="category" resultType="resCntVo">
			SELECT 
			        *
			FROM
			    (SELECT count(*) cnt , category FROM res , category WHERE res.catno = category.catno GROUP BY category.category)
			ORDER BY
    			cnt desc
	 	</select>
	 	
	 	<!-- 관리자 메인페이지 차트 쿼리 -->
	 	<select id="mainCnt" resultType="chartCntVo" parameterType="chartCntVo">
		 	SELECT
			    txtcnt , memcnt, isuemem
			FROM
			    (SELECT count(*) txtcnt FROM txt WHERE isshow = 'Y'),
			    (SELECT count(*) memcnt FROM member WHERE isshow ='Y' and grade = 'M'), 
			    (SELECT count(*) isuemem FROM member WHERE issue ='X' and grade = 'M') 
	 	</select> 
		
		<!-- 업소별 rating 조회 쿼리 -->
		<select id="upso_rating_total" parameterType="String" resultType="ratingUpsoVo">
		SELECT
			rating_star1, rating_star2, rating_star3, rating_star4, rating_star5
		FROM
			(
				SELECT
					count(rating_upso) rating_star1
				FROM
					upso_review
				WHERE
					res_id = #{upso_id}
					AND rating_upso = 1
					AND isshow = 'Y'
				GROUP BY
					res_id
			),
			(
				SELECT
					count(rating_upso) rating_star2
				FROM
					upso_review
				WHERE
					res_id = #{upso_id}
					AND rating_upso = 2
					AND isshow = 'Y'
				GROUP BY
					res_id
			),
			(
				SELECT
					count(rating_upso) rating_star3
				FROM
					upso_review
				WHERE
					res_id = #{upso_id}
					AND rating_upso = 3
					AND isshow = 'Y'
				GROUP BY
					res_id
			),
			(
				SELECT
					count(rating_upso) rating_star4
				FROM
					upso_review
				WHERE
					res_id = #{upso_id}
					AND rating_upso = 4
					AND isshow = 'Y'
				GROUP BY
					res_id
			),
			(
				SELECT
					count(rating_upso) rating_star5
				FROM
					upso_review
				WHERE
					res_id = #{upso_id}
					AND rating_upso = 5
					AND isshow = 'Y'
				GROUP BY
					res_id
			)
		</select>
</mapper>